<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speech to Image</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ Speech to Image</h1>
            <p>Transform your spoken narratives into visual images</p>
        </div>

        <div class="input-mode-selector">
            <div class="mode-tabs">
                <button class="mode-tab active" id="speechTab">üé§ Live Speech</button>
                <button class="mode-tab" id="audioTab">üéµ Audio File</button>
                <button class="mode-tab" id="textTab">‚úè Text Input</button>
            </div>
        </div>

        <div class="input-section active" id="speechSection">
            <div class="controls">
                <button class="btn btn-primary" id="startBtn">
                    <svg class="mic-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                    Start Recording
                </button>
                <button class="btn btn-secondary" id="stopBtn" disabled>Stop Recording</button>
                <button class="btn btn-secondary" id="clearBtn">Clear All</button>
                <button class="btn btn-secondary" id="generateBtn" disabled>Generate Image</button>
            </div>

            <div class="status" id="status">Click "Start Recording" to begin</div>
            <div class="transcript" id="transcript">Your speech will appear here...</div>
        </div>

        <div class="input-section" id="audioSection">
            <div class="controls">
                <button class="btn btn-secondary" id="clearAudioBtn">Clear Audio</button>
                <button class="btn btn-secondary" id="generateAudioBtn" disabled>Generate Image</button>
            </div>
            
            <div class="audio-upload-area" id="audioUploadArea">
                <input type="file" id="audioFileInput" accept="audio/*" style="display: none;">
                <div class="upload-icon">üéµ</div>
                <h3>Upload Audio File</h3>
                <p>Click to browse or drag and drop your audio file here</p>
                <small>Supported formats: MP3, WAV, M4A, OGG</small>
            </div>
            
            <div class="audio-player-section" id="audioPlayerSection" style="display: none;">
                <div class="audio-info">
                    <h4 id="audioFileName">No file selected</h4>
                    <audio controls id="audioPlayer"></audio>
                </div>
                <div class="transcript" id="audioTranscript">
                    Audio transcription will appear here...
                </div>
            </div>
        </div>

        <div class="input-section" id="textSection">
            <div class="controls">
                <button class="btn btn-secondary" id="clearTextBtn">Clear Text</button>
                <button class="btn btn-secondary" id="generateTextBtn" disabled>Generate Image</button>
            </div>
            
            <textarea 
                class="text-input" 
                id="textInput" 
                placeholder="Type your story here... Describe the scenes, actions, and dialogue you want to visualize. Be descriptive for best results."
                rows="8"
            ></textarea>
        </div>

        <div class="storyboard" id="storyboard">
            <div class="empty-state">
                <p>Your generated images will appear here after you provide input and click "Generate Image"</p>
            </div>
            <div id="loadingIndicator" class="loading-indicator" style="display:none;">
                <div class="spinner"></div>
                <span>Processing, please wait...</span>
            </div>
            <a id="downloadBtn" class="download-btn" href="#" download style="display:none;">Download Image</a>
        </div>

        <div class="about-section">
            <h2>About Speech to Image</h2>
            <p>This application uses advanced AI technology to transform spoken words, audio files, or text into vivid images. Whether you're a storyteller, content creator, or just looking to visualize your ideas, our tool makes it easy to bring your narratives to life.</p>
            <p>Features:</p>
            <ul>
                <li>Live speech-to-image conversion</li>
                <li>Audio file upload and processing</li>
                <li>Text-to-image generation</li>
                <li>High-quality AI-generated visuals</li>
            </ul>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        class SpeechToImage {
            constructor() {
                this.recognition = null;
                this.isRecording = false;
                this.transcript = '';
                this.currentMode = 'speech';
                
                this.initElements();
                this.initSpeechRecognition();
                this.bindEvents();
            }

            initElements() {
                // Tabs
                this.speechTab = document.getElementById('speechTab');
                this.audioTab = document.getElementById('audioTab');
                this.textTab = document.getElementById('textTab');

                // Sections
                this.speechSection = document.getElementById('speechSection');
                this.audioSection = document.getElementById('audioSection');
                this.textSection = document.getElementById('textSection');

                // Speech controls
                this.startBtn = document.getElementById('startBtn');
                this.stopBtn = document.getElementById('stopBtn');
                this.clearBtn = document.getElementById('clearBtn');
                this.generateBtn = document.getElementById('generateBtn');
                this.status = document.getElementById('status');
                this.transcriptEl = document.getElementById('transcript');

                // Audio controls
                this.audioUploadArea = document.getElementById('audioUploadArea');
                this.audioFileInput = document.getElementById('audioFileInput');
                this.audioPlayerSection = document.getElementById('audioPlayerSection');
                this.audioPlayer = document.getElementById('audioPlayer');
                this.audioFileName = document.getElementById('audioFileName');
                this.audioTranscript = document.getElementById('audioTranscript');
                this.clearAudioBtn = document.getElementById('clearAudioBtn');
                this.generateAudioBtn = document.getElementById('generateAudioBtn');

                // Text controls
                this.textInput = document.getElementById('textInput');
                this.clearTextBtn = document.getElementById('clearTextBtn');
                this.generateTextBtn = document.getElementById('generateTextBtn');

                // Output
                this.storyboardEl = document.getElementById('storyboard');
            }

            initSpeechRecognition() {
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    this.showError('Speech recognition is not supported in this browser. Please try Chrome or Edge.');
                    return;
                }

                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                this.recognition = new SpeechRecognition();
                
                this.recognition.continuous = true;
                this.recognition.interimResults = true;
                this.recognition.lang = 'en-US';

                this.recognition.onstart = () => {
                    this.isRecording = true;
                    this.updateUI();
                };

                this.recognition.onresult = (event) => {
                    let finalTranscript = '';
                    let interimTranscript = '';

                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript;
                        } else {
                            interimTranscript += transcript;
                        }
                    }

                    this.transcript += finalTranscript;
                    this.transcriptEl.textContent = this.transcript + interimTranscript;
                };

                this.recognition.onerror = (event) => {
                    this.showError(`Speech recognition error: ${event.error}`);
                    this.stopRecording();
                };

                this.recognition.onend = () => {
                    this.isRecording = false;
                    this.updateUI();
                };
            }

            bindEvents() {
                // Tab events
                this.speechTab.addEventListener('click', () => this.switchMode('speech'));
                this.audioTab.addEventListener('click', () => this.switchMode('audio'));
                this.textTab.addEventListener('click', () => this.switchMode('text'));

                // Speech events
                this.startBtn.addEventListener('click', () => this.startRecording());
                this.stopBtn.addEventListener('click', () => this.stopRecording());
                this.clearBtn.addEventListener('click', () => this.clearAll());
                this.generateBtn.addEventListener('click', () => this.generateImage('speech'));

                // Audio events
                this.audioUploadArea.addEventListener('click', () => this.audioFileInput.click());
                this.audioFileInput.addEventListener('change', (e) => this.handleAudioUpload(e));
                this.clearAudioBtn.addEventListener('click', () => this.clearAudio());
                this.generateAudioBtn.addEventListener('click', () => this.generateImage('audio'));

                // Text events
                this.textInput.addEventListener('input', () => this.handleTextInput());
                this.clearTextBtn.addEventListener('click', () => this.clearText());
                this.generateTextBtn.addEventListener('click', () => this.generateImage('text'));

                // Drag and drop for audio
                this.audioUploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.audioUploadArea.style.borderColor = '#667eea';
                });

                this.audioUploadArea.addEventListener('dragleave', () => {
                    this.audioUploadArea.style.borderColor = '#bdc3c7';
                });

                this.audioUploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.audioUploadArea.style.borderColor = '#bdc3c7';
                    const file = e.dataTransfer.files[0];
                    if (file && file.type.startsWith('audio/')) {
                        this.handleAudioFile(file);
                    }
                });
            }

            switchMode(mode) {
                this.currentMode = mode;
                
                // Update tabs
                [this.speechTab, this.audioTab, this.textTab].forEach(tab => {
                    tab.classList.remove('active');
                });
                document.getElementById(`${mode}Tab`).classList.add('active');

                // Update sections
                [this.speechSection, this.audioSection, this.textSection].forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById(`${mode}Section`).classList.add('active');
            }

            handleAudioUpload(event) {
                const file = event.target.files[0];
                if (file) {
                    this.handleAudioFile(file);
                }
            }

            handleAudioFile(file) {
                this.audioFileName.textContent = file.name;
                this.audioPlayer.src = URL.createObjectURL(file);
                this.audioPlayerSection.style.display = 'block';
                this.generateAudioBtn.disabled = false;
                // Here you would typically add audio transcription logic
            }

            handleTextInput() {
                this.generateTextBtn.disabled = !this.textInput.value.trim();
            }

            clearAudio() {
                this.audioFileInput.value = '';
                this.audioPlayer.src = '';
                this.audioFileName.textContent = 'No file selected';
                this.audioPlayerSection.style.display = 'none';
                this.audioTranscript.textContent = 'Audio transcription will appear here...';
                this.generateAudioBtn.disabled = true;
            }

            clearText() {
                this.textInput.value = '';
                this.generateTextBtn.disabled = true;
            }

            startRecording() {
                if (this.recognition) {
                    this.recognition.start();
                }
            }

            stopRecording() {
                if (this.recognition) {
                    this.recognition.stop();
                }
            }

            clearAll() {
                this.transcript = '';
                this.transcriptEl.textContent = 'Your speech will appear here...';
                this.storyboardEl.innerHTML = '<div class="empty-state"><p>Your generated images will appear here after you provide input and click "Generate Image"</p></div>';
                this.generateBtn.disabled = true;
            }

            updateUI() {
                this.startBtn.disabled = this.isRecording;
                this.stopBtn.disabled = !this.isRecording;
                this.generateBtn.disabled = !this.transcript.trim();
                
                if (this.isRecording) {
                    this.status.textContent = 'üî¥ Recording... Speak your story';
                    this.status.className = 'status recording';
                } else {
                    this.status.textContent = this.transcript.trim() ? 'Recording complete. Click "Generate Image" to create visuals.' : 'Click "Start Recording" to begin';
                    this.status.className = 'status';
                }
            }

            generateImage(mode) {
                let text = '';
                switch (mode) {
                    case 'speech':
                        text = this.transcript;
                        break;
                    case 'audio':
                        text = this.audioTranscript.textContent;
                        break;
                    case 'text':
                        text = this.textInput.value;
                        break;
                }

                if (!text.trim()) return;

                // Here you would typically add image generation logic
                this.storyboardEl.innerHTML = `
                    <div class="panel">
                        <div class="visual-area">
                            <div class="visual-placeholder">
                                üé®<br>
                                Generated image will appear here<br>
                                <small>Processing your input...</small>
                            </div>
                        </div>
                        
                        <div class="scene-description">
                            <h4>Input Text</h4>
                            <div class="scene-text">${text}</div>
                        </div>
                    </div>
                `;
            }

            showError(message) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.textContent = message;
                
                this.transcriptEl.parentNode.insertBefore(errorDiv, this.transcriptEl);
                
                setTimeout(() => {
                    if (errorDiv.parentNode) {
                        errorDiv.parentNode.removeChild(errorDiv);
                    }
                }, 5000);
            }
        }

        // Initialize the app
        new SpeechToImage();
    </script>
</body>
</html>